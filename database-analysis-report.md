# ุชูุฑูุฑ ุชุญููู ูุงุนุฏุฉ ุงูุจูุงูุงุช - AziziChat

## ๐ ููุฎุต ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ:
1. **Users** - 4 ูุณุชุฎุฏููู
2. **Contacts** - 6 ุนูุงูุงุช
3. **Messages** - 19 ุฑุณุงูุฉ
4. **Rooms** - 3 ุบุฑู

---

## ๐ ุชุญููู ุงูุฌุฏุงูู

### 1. ุฌุฏูู Users
**ุงูุฃุนูุฏุฉ ุงูุญุงููุฉ:**
- `Id` (int, PK)
- `Username` (nvarchar(50), UNIQUE)
- `Email` (nvarchar(100), UNIQUE, NULL)
- `PasswordHash` (nvarchar(255))
- `IsEmailVerified` (bit, DEFAULT 0)

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- โ ุฅุถุงูุฉ `CreatedAt` ูุชุณุฌูู ุชุงุฑูุฎ ุฅูุดุงุก ุงูุญุณุงุจ
- โ ุฅุถุงูุฉ `LastLogin` ูุชุณุฌูู ุขุฎุฑ ูุฑุฉ ุชู ูููุง ุชุณุฌูู ุงูุฏุฎูู
- โ ุฅุถุงูุฉ `IsActive` ูุชุนุทูู ุงูุญุณุงุจุงุช ุจุฏูุงู ูู ุญุฐููุง
- โ ุฅุถุงูุฉ ููุฑุณ ุนูู `Email` ูุชุญุณูู ุฃุฏุงุก ุงูุจุญุซ

**ุงูููุงุฑุณ ุงูุญุงููุฉ:**
- โ PRIMARY KEY ุนูู `Id`
- โ UNIQUE ุนูู `Username`
- โ UNIQUE ุนูู `Email`

---

### 2. ุฌุฏูู Contacts
**ุงูุฃุนูุฏุฉ ุงูุญุงููุฉ:**
- `Id` (int, PK)
- `UserId` (int, FK โ Users.Id)
- `ContactUserId` (int, FK โ Users.Id)
- `Status` (nvarchar(20), DEFAULT 'pending')
- `CreatedAt` (datetime, DEFAULT getdate())

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- โ ุฅุถุงูุฉ `UpdatedAt` ูุชุณุฌูู ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ
- โ ุฅุถุงูุฉ ููุฑุณ ุนูู `Status` ููุจุญุซ ุงูุณุฑูุน ุนู ุงูุทูุจุงุช ุงููุนููุฉ
- โ ุฅุถุงูุฉ ููุฑุณ ูุฑูุจ ุนูู `(UserId, Status)` ููุจุญุซ ุงูุณุฑูุน
- โ ุฅุถุงูุฉ ููุฑุณ ุนูู `ContactUserId` ููุจุญุซ ุนู ุงูุทูุจุงุช ุงููุงุฑุฏุฉ

**ุงูููุงุฑุณ ุงูุญุงููุฉ:**
- โ PRIMARY KEY ุนูู `Id`
- โ UNIQUE ุนูู `(UserId, ContactUserId)`

**ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ:**
- โ `UserId` โ `Users.Id`
- โ `ContactUserId` โ `Users.Id`

---

### 3. ุฌุฏูู Messages
**ุงูุฃุนูุฏุฉ ุงูุญุงููุฉ:**
- `Id` (int, PK)
- `RoomId` (int, FK โ Rooms.Id)
- `UserId` (int, FK โ Users.Id)
- `Content` (nvarchar(MAX))
- `CreatedAt` (datetime2, DEFAULT sysdatetime())

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- โ ุฅุถุงูุฉ ููุฑุณ ุนูู `RoomId` ูุชุญุณูู ุฃุฏุงุก ุฌูุจ ุงูุฑุณุงุฆู
- โ ุฅุถุงูุฉ ููุฑุณ ูุฑูุจ ุนูู `(RoomId, CreatedAt)` ููุชุฑุชูุจ ุงูุฒููู
- โ ุฅุถุงูุฉ `IsRead` ูุชุชุจุน ุงูุฑุณุงุฆู ุงูููุฑูุกุฉ
- โ ุฅุถุงูุฉ `IsDeleted` ููุณูุงุญ ุจุญุฐู ุงูุฑุณุงุฆู (soft delete)

**ุงูููุงุฑุณ ุงูุญุงููุฉ:**
- โ PRIMARY KEY ุนูู `Id`

**ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ:**
- โ `RoomId` โ `Rooms.Id`
- โ `UserId` โ `Users.Id`

---

### 4. ุฌุฏูู Rooms
**ุงูุฃุนูุฏุฉ ุงูุญุงููุฉ:**
- `Id` (int, PK)
- `Name` (nvarchar(100))
- `IsPrivate` (bit, DEFAULT 0)
- `User1Id` (int, FK โ Users.Id, NULL)
- `User2Id` (int, FK โ Users.Id, NULL)

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- โ ุฅุถุงูุฉ `CreatedAt` ูุชุณุฌูู ุชุงุฑูุฎ ุฅูุดุงุก ุงูุบุฑูุฉ
- โ ุฅุถุงูุฉ `LastMessageAt` ูุชุณุฌูู ุขุฎุฑ ุฑุณุงูุฉ ูู ุงูุบุฑูุฉ
- โ ุฅุถุงูุฉ ููุฑุณ ุนูู `IsPrivate` ููุจุญุซ ุงูุณุฑูุน

**ุงูููุงุฑุณ ุงูุญุงููุฉ:**
- โ PRIMARY KEY ุนูู `Id`
- โ UNIQUE ุนูู `(User1Id, User2Id)`

**ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ:**
- โ `User1Id` โ `Users.Id`
- โ `User2Id` โ `Users.Id`

---

## ๐ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุงูููุงุฑุณ (Indexes)
ุชู ุฅุถุงูุฉ ุงูููุงุฑุณ ุงูุชุงููุฉ ูุชุญุณูู ุงูุฃุฏุงุก:
- `IX_Users_Email` - ููุจุญุซ ุงูุณุฑูุน ุนู ุงููุณุชุฎุฏููู ุจุงูุฅูููู
- `IX_Contacts_Status` - ููุจุญุซ ุงูุณุฑูุน ุนู ุทูุจุงุช ุงูุตุฏุงูุฉ
- `IX_Contacts_UserId_Status` - ููุจุญุซ ุงูุณุฑูุน ุนู ุทูุจุงุช ูุณุชุฎุฏู ูุนูู
- `IX_Contacts_ContactUserId` - ููุจุญุซ ุนู ุงูุทูุจุงุช ุงููุงุฑุฏุฉ
- `IX_Messages_RoomId` - ูุฌูุจ ุงูุฑุณุงุฆู ุจุณุฑุนุฉ
- `IX_Messages_RoomId_CreatedAt` - ููุชุฑุชูุจ ุงูุฒููู
- `IX_Messages_IsDeleted` - ููุจุญุซ ุนู ุงูุฑุณุงุฆู ุบูุฑ ุงููุญุฐููุฉ
- `IX_Rooms_IsPrivate` - ููุจุญุซ ุงูุณุฑูุน ุนู ุงูุบุฑู ุงูุฎุงุตุฉ

### 2. Triggers
ุชู ุฅูุดุงุก Triggers ุชููุงุฆูุฉ:
- `TR_Contacts_UpdateUpdatedAt` - ุชุญุฏูุซ `UpdatedAt` ุชููุงุฆูุงู ุนูุฏ ุชุญุฏูุซ Contact
- `TR_Messages_UpdateRoomLastMessage` - ุชุญุฏูุซ `LastMessageAt` ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุฑุณุงูุฉ

### 3. Views
ุชู ุฅูุดุงุก Views ูุณูููุฉ ุงูุงุณุชุนูุงู:
- `vw_AcceptedContacts` - ุนุฑุถ ุฌูุงุช ุงูุงุชุตุงู ุงูููุจููุฉ ูุน ูุนูููุงุช ุงููุณุชุฎุฏููู
- `vw_UnreadMessages` - ุนุฑุถ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ููุงุท ุงูููุฉ:
1. โ ูุฌูุฏ Foreign Keys ูุถูู ุณูุงูุฉ ุงูุจูุงูุงุช
2. โ ูุฌูุฏ UNIQUE constraints ูููุน ุงูุชูุฑุงุฑ
3. โ ุงุณุชุฎุฏุงู NVarChar ููุฃุญุฑู ุงูุนุฑุจูุฉ
4. โ ูุฌูุฏ CreatedAt ูู ุจุนุถ ุงูุฌุฏุงูู

### ููุงุท ุชุญุชุงุฌ ุชุญุณูู:
1. โ๏ธ ุจุนุถ ุงูุฌุฏุงูู ุชูุชูุฑ ุฅูู `CreatedAt`
2. โ๏ธ ุนุฏู ูุฌูุฏ `UpdatedAt` ูู ูุนุธู ุงูุฌุฏุงูู
3. โ๏ธ ุนุฏู ูุฌูุฏ ููุงุฑุณ ุนูู ุจุนุถ ุงูุฃุนูุฏุฉ ุงููุณุชุฎุฏูุฉ ุจูุซุฑุฉ ูู ุงูุจุญุซ
4. โ๏ธ ุนุฏู ูุฌูุฏ ุฏุนู ููู soft delete ูู Messages
5. โ๏ธ ุนุฏู ูุฌูุฏ ุชุชุจุน ููุฑุณุงุฆู ุงูููุฑูุกุฉ

---

## ๐ง ุฎุทูุงุช ุงูุชุทุจูู

1. **ูุณุฎ ุงุญุชูุงุทู**: ูู ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ุงูุชุทุจูู
2. **ุชุทุจูู ุงูุชุญุณููุงุช**: ูู ุจุชุดุบูู ููู `database-improvements.sql`
3. **ุงูุชุญูู**: ุชุฃูุฏ ูู ุชุทุจูู ุฌููุน ุงูุชุญุณููุงุช ุจูุฌุงุญ
4. **ุงุฎุชุจุงุฑ**: ุงุฎุชุจุฑ ุงูุชุทุจูู ููุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู ุจุดูู ุตุญูุญ

---

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. **ุฌุฏูู Notifications** - ูุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
2. **ุฌุฏูู Sessions** - ูุฅุฏุงุฑุฉ ุฌูุณุงุช ุงููุณุชุฎุฏููู
3. **ุฌุฏูู AuditLog** - ูุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงููููุฉ
4. **ุฏุนู ุงููุฑููุงุช** - ุฅุถุงูุฉ ุฌุฏูู Attachments ููุฑุณุงุฆู
5. **ุชุงุฑูุฎ ุงูุชุนุฏูู** - ุฅุถุงูุฉ ุฌุฏูู EditHistory ููุฑุณุงุฆู ุงููุญุฑุฑุฉ

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ**: 2025-12-27
**ุงูุฅุตุฏุงุฑ**: 1.0

